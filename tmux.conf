#utf8 setting
if '[ $(tmux -V | cut -d " " -f 2) -lt 2.0 ]' 'set-window-option -g utf8 on'
set-window-option -g mode-keys vi
set-window-option -g automatic-rename off

# set -g status-bg white
# set -g status-fg black
#
set -g history-limit 8192

set -s escape-time 0

# 256色ターミナル
#set-option -g default-terminal "screen-256color"
set-option -g default-terminal "xterm-256color"

# ステータスラインカスタム関連
set -g status-style bg=black,fg=white,dim
# 左部:whoami@hostname
set -g status-left '#[fg=blue,bold][#I-#P]#[default]'
set -g status-left-length 20
# 右部:[2011/03/06(Sun)20:21]
set -g status-right '#[fg=blue,bold][%Y/%m/%d(%a)%H:%M]#[default]'
set -g message-style bold,fg=white,bg=red

set -g pane-active-border-style fg=white,bg=black

set-window-option -g mode-style bg=white,fg=black
set-window-option -g window-status-style bg=black,fg=white
set-window-option -g window-status-current-style underscore,bg=blue,fg=black,bold

# Set the prefix to C-z.
unbind C-b
set -g prefix C-z
bind z send-prefix
bind C-z send-prefix

# Bind appropriate commands similar to screen.
# lockscreen ^X x
# unbind ^X
# bind ^X lock-server
# unbind x
# bind x lock-server

unbind r
bind-key -N "再読み込み" r {
  source-file ~/.tmux.conf ; \
  display-message "Reload Config!!"
}

# screen C-c c
unbind C-c
bind C-c new-window -n zsh
bind c new-window -n zsh

# detach C-d
unbind C-d
bind C-d detach

# displays *
unbind *
bind * list-clients

# next  C-n
unbind C-n
bind -r C-n next-window

# title A
unbind A
bind A command-prompt "rename-window %%"

# copy-mode C-[
unbind C-[
bind -r C-[ copy-mode
unbind C-]
bind -r C-] paste-buffer

# other C-a
unbind C-a
bind C-a last-window

# prev  C-p
unbind C-p
bind -r C-p previous-window

# windows w
unbind w
bind w list-windows

# quit \
unbind \
bind \ confirm-before "kill-server"

# kill K k
unbind K
bind K confirm-before "kill-window"
unbind k
bind k confirm-before "kill-window"

# kill-pane x (default)
#unbind x
#bind x confirm-before "kill-pane"

# redisplay C-r r
unbind C-r
bind C-r refresh-client
unbind r
bind r refresh-client

# split 
# split -v |
unbind |
bind | split-window -h
unbind %
bind % split-window -v

# :kB: focus up
unbind Tab
bind Tab select-pane -t :.-
unbind BTab
bind BTab select-pane -t :.+
unbind C-h
bind C-h select-pane -t :.-
unbind h
bind h select-pane -t :.-
unbind C-l
bind C-l select-pane -t :.+
unbind l
bind l select-pane -t :.+

bind -r '<' resize-pane -L 5
bind -r '>' resize-pane -R 5
bind -r '-' resize-pane -D 5
bind -r '+' resize-pane -U 5

# " windowlist -b
unbind '"'
bind '"' choose-window

unbind m
bind-key m display-popup -E -w 80% -h 80% "tmux-session-manager"
unbind M
bind-key M display-popup -E -w 80% -h 80% "tmux-move-window"

# clipbordにコピー
if 'which tmux-pbcopy >/dev/null 2>&1'  "bind C-y run-shell 'tmux-pbcopy'"
# zshでpbcopy
if 'which reattach-to-user-namespace >/dev/null 2>&1'  "set-option -g default-command 'reattach-to-user-namespace -l zsh'"

# show------------------------------------------------------------
# #(shell command) コマンド出力の最初の行
# #[attribute] 色や属性
# #S セッション名
# #W カレントウィンドウの名前
# カレントディレクトリにウインドウ名を修正
set-option -g automatic-rename on
set-option -g automatic-rename-format '#{b:pane_current_path}'
# ウィンドウを閉じた時に番号を詰める
set-option -g renumber-windows on
set-option -g status "on"
set-option -g status-interval 60
# base: https://daisyui.com/docs/themes/
# https://daisyui.com/theme-generator/#theme=eJyVlPFugyAQxl-FmCzZkkoABXVvQ_VczawYsFm7Ze--ExtrizXZn3f3-77jDsJP1OkjRO-R3l-ci3ZRaVpjY1cewKcrbT8xG8dTfq8dxJwxrJjPtjy8CvZCGGU5Eax4ewTFAuRyA0yW4JZjaboBumGGiwnOFMkYVUW2FPS2OWp7ubFiZIWSCeFCrpCBu2TPFA6QrZbueUJFdj1MSkSR02RVEDRJt4W6LO9pRAkLiXA1eUB2cBqsbmckebLqK_evbTddbWYwS0eQKyISQZXij2DgLArvrFCB--DyztqdcEJ8nLO7h_HMhEtOM85X4LCDmjpIFAlaJOlS9KVt13Qft8tMae4nKJQgGCixQoc3uakCa42dWSUnMpc4MRUhGQ6QrSmsrpqTw-fVQjl4f2HhuCzVDbQV5nFj8qG0N2dfmPOu-Yal11Lja2tme2MrGGnen32ign44jLGPOtO48SdhGFVQ61OLM9W6dbCLegs1WOc_mSn3-wcK-0x_
# oklch -> RGB: https://oklch.com
set-option -g @c-base-100 "#001C23"
set-option -g @c-base-200 "#001015"
set-option -g @c-base-300 "#000509"
set-option -g @c-base-content "#FFD6A7"
set-option -g @c-primary "#BEFF00"
set-option -g @c-primary-content "#507000"
set-option -g @c-secondary "#CEBEF4"
set-option -g @c-secondary-content "#564775"
set-option -g @c-accent "#505050"
set-option -g @c-accent-content "#F8F8F8"
set-option -g @c-neutral "#003741"
set-option -g @c-neutral-content "#FFD6A7"
set-option -g @c-info "#00BAFE"
set-option -g @c-info-content "#042E49"
set-option -g @c-success "#01DF72"
set-option -g @c-success-content "#022D14"
set-option -g @c-warning "#FFC000"
set-option -g @c-warning-content "#714E00"
set-option -g @c-error "#F04E4F"
set-option -g @c-error-content "#550001"
set-option -g status-style "bg=#{@c-base-100}"

set-option -g status-left '#(tmux-status-sessions)'
set-option -g status-left-length 30
set-option -g status-right '#( \
  label="%m/%d(%a) %H:%M"; \
  bg="#{@c-base-100}"; \
  color="#{@c-info}"; \
  text_fg="#{@c-info-content}"; \
  echo " #[bg=$bg,fg=$color]#[bg=$color,fg=$text_fg]$label#[bg=$bg,fg=$color]"; \
)'

set-option -gw window-status-separator ""
# `sleep 2; printf "\a"`でベル確認できる
set-option -gw window-status-format '#( \
  label="#{?window_zoomed_flag,,} #W "; \
  bg="#{@c-base-100}"; \
  color="#{@c-neutral}"; \
  text_fg="#{@c-neutral-content}"; \
  if [ "#{window_bell_flag}" = "1" ]; then \
    label=" 󱅫 #W "; \
    color="#{@c-info}"; \
    text_fg="#{@c-info-content}"; \
  fi; \
  echo "#[bg=$bg,fg=$color]#[bg=$color,fg=$text_fg]$label#[bg=$bg,fg=$color]"; \
)'
# window-status-format で表示するため、デフォルトのreverseさせない
set-option -gw window-status-bell-style "bold"
set-option -gw window-status-current-format '#( \
  label="#{?window_zoomed_flag,,} #W "; \
  bg="#{@c-base-100}"; \
  color="#{@c-primary}"; \
  text_fg="#{@c-primary-content}"; \
  echo "#[bg=$bg,fg=$color]#[bg=$color,fg=$text_fg,bold]$label#[bg=$bg,fg=$color,nobold]"; \
)'

# メッセージ
set-option -g message-style "bg=#{@c-info},fg=#{@c-info-content},bold"
# status-keysがviで、insertモード以外のとき
set-option -g message-command-style "bg=#{@c-accent},fg=#{@c-accent-content}"

# ボーダー
set-option -g pane-border-style "fg=#{@c-base-content}"
set-option -g pane-active-border-style "fg=#{@c-primary}"
set-option -g pane-border-indicators both

# コピーモードの右上など
set-option -g mode-style "bg=#{@c-warning},fg=#{@c-warning-content},bold"

# マウス操作の有効化
set-option -g mouse on

# copy and paste
set-option -gw mode-keys vi
set-option -s set-clipboard on
# コピーモードでマウス範囲選択の時にすぐコピーされてしまうのを解除
unbind-key -T copy-mode-vi MouseDragEnd1Pane
bind-key -T copy-mode-vi DoubleClick1Pane { select-pane ; send-keys -X select-word }

unbind-key [
bind-key [ { copy-mode ; display-message "Copy mode!" }

unbind-key ]
bind-key ] { copy-mode ; display-message "Copy mode!" }
bind-key v { copy-mode ; display-message "Copy mode!" }
bind-key V { copy-mode ; display-message "Copy mode!" }
bind-key C-v { copy-mode ; display-message "Copy mode!" }

bind-key -T copy-mode-vi v { send-keys -X begin-selection }
bind-key -T copy-mode-vi C-v { send-keys -X rectangle-toggle }
bind-key -T copy-mode-vi V { send-keys -X select-line }
bind-key -T copy-mode-vi y { send-keys -X copy-pipe }
bind-key -N "cmode: 選択範囲を言語指定してbatで表示" -T copy-mode-vi C {
  command-prompt -p 'language:' \
    -I "md" \
    "send-keys -X copy-pipe-no-clear '\
      tmux load-buffer -; \
      tmux display-popup  -w 95% -h 90% -E \
        \"tmux show-buffer | bat --paging=always -l=%%\"
        '
    "
}
